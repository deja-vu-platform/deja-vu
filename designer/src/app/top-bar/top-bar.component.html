<mat-toolbar class="mat-toolbar" id="top-bar" *ngIf="app">
  <button
    mat-button
    id="edit-action"
    class="mat-small"
    (click)="editAction()"
  >
    <mat-icon>more_vert</mat-icon>
  </button>
  <mat-form-field>
    <mat-select
      name="action"
      [(ngModel)]="openAction"
      (selectionChange)="onSelectAction($event)"
    >
      <button
        mat-raised-button
        id="create-action"
        color="primary"
        (click)="createAction()"
      >
        <mat-icon>add_circle</mat-icon> Create Action
      </button>
      <mat-option
        *ngFor="let action of app.actions"
        [value]="action"
      >
        {{action.name}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <button mat-button
    #menuTrigger="matMenuTrigger"
    [matMenuTriggerFor]="menu.matMenu"
    class="mat-small"
  >
    <mat-icon>input</mat-icon>
  </button>

  <div class="right">
    <mat-form-field>
      <input matInput name="appName" [(ngModel)]="app.name">
    </mat-form-field>
    <button
      mat-button
      class="mat-small"
      (click)="open()"
      [disabled]="opening"
      matTooltip="Open"
    >
      <mat-icon>folder_open</mat-icon>
    </button>
    <button
      mat-button
      class="mat-small"
      (click)="save()"
      [disabled]="saving"
      matTooltip="Save"
    >
      <mat-icon>save</mat-icon>
    </button>
    <button
      mat-button
      class="mat-small"
      (click)="export()"
      [disabled]="!this.fs || exporting"
      matTooltip="Export"
    >
      <mat-icon>publish</mat-icon>
    </button>
  </div>

  <app-floating-menu
    #menu
    [title]="app.name + '-' + openAction.name"
    (opened)="clickFirstTab(menuContent)"
    (shouldClose)="closeMenu(menuTrigger)"
  >
    <mat-tab-group #menuContent class="popup-menu action-menu">
      <mat-tab label="Outputs">
        <div class="io-container">
          <div
            *ngFor="let output of openAction.outputSettings"
            class="io-and-button"
          >
            <mat-form-field>
              <input
                matInput
                class="input-value"
                [placeholder]="output.name"
                [name]="output.name"
                [(ngModel)]="output.value"
                dragula="expression-io"
                (addOutput)="addOutput(output, $event)"
              >
            </mat-form-field>
            <button mat-button color="warn" (click)="removeIO(output)" class="mat-small rm">
              <mat-icon>remove_circle</mat-icon>
            </button>
          </div>
        </div>
        <button mat-button color="primary" (click)="addIO('output')" class="add-io">
          <mat-icon>add_circle</mat-icon> Add Output 
        </button>
      </mat-tab>
      <mat-tab label="Inputs">
        <div dragula="expression-io" class="inputtables io-container">
          <div
            class="io-and-button"
            *ngFor="let input of openAction.inputSettings"
            [attr.data-output]="'$' + input.name"
          >
            <div>
                {{input.name}}
            </div>
            <button mat-button color="warn" (click)="removeIO(input)" class="mat-small rm">
              <mat-icon>remove_circle</mat-icon>
            </button>
          </div>
          <div *ngIf="openAction.inputSettings.length === 0" class="no-drag">
            This action has no inputs.
          </div>
          <button mat-button color="primary" (click)="addIO('input')" class="add-io">
            <mat-icon>add_circle</mat-icon> Add Input 
          </button>
        </div>
      </mat-tab>
    </mat-tab-group>
  </app-floating-menu>
</mat-toolbar>

<!-- invisible elements needed for rather hacky reasons -->
<div style="display:none">
  <input #fileInput type="file" (change)="onUpload($event)">
  <a #downloadAnchor></a>
</div>
