<div id="main-view">
  <div id="page" *ngIf="actionInstance">
    <div
      *ngFor="let row of rows; let rowNum = index"
      class="dvd-row"
      dragula="action"
      [attr.data-index]="rowNum"
    >
      <div
        *ngFor="let action of row.actions; let actionNum = index"
        class="action"
        [attr.data-index]="actionNum"
      >
        <!-- unfortunately we can't apply inputs conditionally -->
        <div *ngIf="action.of.inputs.length === 0">
          <app-action-instance
            [actionInstance]="action"
            [actionIO]="scopeIO.getActionIO(action)"
          >
          </app-action-instance>
        </div>
        <div
          *ngIf="action.of.inputs.length > 0"
          #menuTrigger="matMenuTrigger"
          [matMenuTriggerFor]="menu"
        >
          <app-action-instance
            [actionInstance]="action"
            [actionIO]="scopeIO.getActionIO(action)"
          >
          </app-action-instance>
          <mat-menu #menu="matMenu" [overlapTrigger]="false" (closed)="onMenuClosed(action)">
            <div class="popup-menu" (click)="$event.stopPropagation()">
              <ng-container *ngFor="let input of action.of.inputs">
                  <mat-form-field *ngIf="action.of.actionInputs.indexOf(input) === -1">
                    <input
                      matInput
                      class="input-value"
                      [placeholder]="input"
                      [name]="input"
                      [(ngModel)]="action.inputSettings[input]">
                  </mat-form-field>
                  <div *ngIf="action.of.actionInputs.indexOf(input) >= 0">
                    <!-- TODO: pass in action component -->
                    <button
                      mat-button
                      class="replace-action"
                      matTooltip="Replace Action"
                    >
                      <span class="name">{{ input + ':'}}</span>
                      <span class="value">
                        {{ action.inputSettings[input] || 'Default' }}
                      </span>
                    </button>
                  </div>
              </ng-container>
            </div>
          </mat-menu>
        </div>
      </div>
    </div>
  </div>
</div>