<dv.action name="submit-post">
  <hackernews.navbar />

  <dv.tx>
    <authentication.logged-in />
    <dv.redirect href="/login" params={ callback: '/submit' }
      onEvalFailure=true />
  </dv.tx>

  <div class="main">
    <div class="container">
      <dv.if condition=hackernews.navbar.loggedInUser>
        <dv.tx>
          <dv.gen-id />
          <authentication.authenticate
            id=hackernews.navbar.loggedInUser.id hidden=true />
          <property.create-object
            buttonLabel="Submit"
            id=dv.gen-id.id
            initialValue={ author: hackernews.navbar.loggedInUser.username }
            newObjectSavedText="Post submitted"
            showExclude=['author']
            showOptionToSubmit=hackernews.navbar.loggedInUser />
          <!-- use author as sourceId of initial score -->
          <!-- also allows database to prevent author from upvoting own post -->
          <scoringposts.create-score
            sourceId=hackernews.navbar.loggedInUser.username
            targetId=dv.gen-id.id
            value=0
            hidden=true />

          <dv.link href="/item" params={ id: dv.gen-id.id } hidden=true />
        </dv.tx>
      </dv.if>
    </div>
  </div>
</dv.action>
