<potluck-nav-bar (loggedInUser)="user=$event"></potluck-nav-bar>

<div class="container" id="homepage-container">
  <div class="col-md-12">
    <div class="row">
      <div class="col-md-12">
        <dv-link href="parties" class="btn btn-primary">
          <i class="material-icons icon">arrow_back</i>
          Back to Your Parties
        </dv-link>
      </div>
    </div>
    <div class="row">
      <div class="col-md-10 offset-md-1 list-group-item"
        id="party-form-content">
        <div class="row" id="party-form-header">
          <div class="col-md-12">
            <h4 id="create-party-title">Create a New Party</h4>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <form class="form-horizontal">
              <dv-tx>
                <div class="row">
                  <div class="col-md-5">
                    <dv-id (id)="partyId=$event"></dv-id>
                    <dv-status savedText="Party created"></dv-status>

                    <property-create-object
                      dvOf="party"
                      [id]="partyId"
                      [showOptionToSubmit]="false">
                    </property-create-object>
                  </div>
                  <div class="col-md-2"></div>
                  <div class="col-md-5">
                    <event-create-event
                      [id]="partyId"
                      [showOptionToSubmit]="false">
                    </event-create-event>
                  </div>
                </div>
                <hr class="divider">
                <div class="row">
                  <div class="col-md-5">
                    <dv-stage
                      [stageEntity]="{
                        type: chooseUser, tag: 'authentication-choose-user',
                        inputs: { chooseSelectPlaceholder: 'Choose Guest', addButtonLabel: 'Add to Guest List' },
                        outputMap: { stage: 'selectedUser' }
                      }"
                      [showEntity]="{
                        type: showGuestUsername, tag: 'authentication-show-user', inputMap: { entity: 'user' }
                      }"
                      [stageHeader]="{ type: guestListHeader, tag: 'potluck-guest-list-header' }"
                      (stagedEntities)="stagedMemberIds=$event">
                    </dv-stage>
                    <!-- for the members dropdown we'll need to retrieve users or provide some kind of autocomplete -->
                    <!--
                    <group-create-group
                      [id]="partyId"
                      [showMember]="{ type: showGuestUsername }"
                      [stageHeader]="{ type: guestListHeader, tag: 'potluck-guest-list-header' }"
                      memberAutocompletePlaceholder="Choose Guest"
                      stageMemberButtonLabel="Add to Guest List"
                      (stagedMemberIds)="stagedMemberIds=$event"
                      [showOptionToSubmit]="false">
                    </group-create-group>
                    -->
                  </div>
                  <div class="col-md-2"></div>
                  <div class="col-md-5">
                    <!-- stage-objects -->
                    <dv-stage
                      [stageEntity]="{
                        type: createSupply, tag: 'potluck-create-supply', outputMap: { stage: 'supply' },
                        inputs: { save: false }
                      }"
                      [showEntity]="{
                        type: showSupply, tag: 'potluck-show-supply', inputMap: { entity: 'supply' }
                      }"
                      [stageHeader]="{ type: supplyListHeader, tag: 'potluck-supply-list-header' }"
                      (stagedEntities)="stagedSupplies=$event">
                    </dv-stage>
                    <!--
                    <market-create-goods
                      [marketId]="partyId"
                      [createGood]="{
                        type: createSupply,
                        outputMap: {good: 'supply'}
                      }"
                      [showGood]="{
                        type: showSupply,
                        inputMap: {good: 'supply'}
                      }"
                      [stagedGoodsHeader]="{ type: supplyListHeader }"
                      [showOptionToInputPrice]="false"
                      [showOptionToInputSeller]="false"
                      [showOptionToSubmit]="false"

                      (stagedGoods)="stagedSupplies=$event">
                    </market-create-goods>
                    -->
                  </div>
                </div>

                <property-create-objects
                  dvOf="supply"
                  [objects]="stagedSupplies"
                  [hidden]="true">
                </property-create-objects>
                <transfer-add-to-balance
                  [accountId]="partyId"
                  [amount]="stagedSupplies"
                  [hidden]="true">
                </transfer-add-to-balance>
                <authorization-create-resource
                  [id]="partyId"
                  [ownerId]="user?.id"
                  [viewerIds]="stagedMemberIds"
                  [hidden]="true">
                </authorization-create-resource>
                <authentication-authenticate
                  [id]="user?.id" [hidden]="true">
                </authentication-authenticate>

                <div class="row" id="party-form-footer">
                  <div class="offset-md-4 col-md-3">
                    <dv-button>Create Party</dv-button>
                  </div>
                </div>
              </dv-tx>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
