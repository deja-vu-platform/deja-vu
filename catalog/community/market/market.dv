// Exchange goods for money
// The current version of this clich√© doesn't allow multiple sellers for the
// same good
cliche Market {
  /** Entities **/
  // A buyer or seller that participates in markets
  // balances are global (not tied to one market)
  data Party {
    balance: number
  }

  // Each good is tied to a single seller and market
  data Good {
    name: text,
    price: number,
    seller: Party,
    supply: number,
    market: Market
  }

  // A record of a purchase/sale in the marketplace
  // [buyer] bought [quantity] [good]s from [seller] for $[price] each
  data Transaction {
    good: Good,
    buyer: Party,
    seller: Party,
    price: number,
    quantity: number,
    market: Market
  }

  data CompoundTransaction {
    transactions: [Transaction],
    buyer: Party,
    paid: boolean
  }

  data Market {}

  /** Widgets **/
  widget BuyGoodButton {
    good: Good,
    quantity: number,
    fraction: number, // fraction of offer price
    buyer: Party
  }

  widget CreateCompoundTransactionButton {
    transactions: [Transaction],
    buyer: Party
    // TODO: do we want a single buyer and/or seller for the entire compound transaction? 
    it's also a little redundant since each transaction also has a buyer and a seller
  }

  widget AddTransactionButton {
    transaction: Transaction,
    compound_transaction: CompoundTransaction
  }

  widget PayForCompoundTransactionButton {
    compound_transaction: CompoundTransaction
  }

  widget CancelCompoundTransactionButton {
    compound_transaction: CompoundTransaction
  }

  widget ShowCompoundTransaction uses ShowAllTransactions {
    compound_transaction: CompoundTransaction
  }

  widget BuyGoodQuantity {
    quantity: number
  }

  widget BuyGoodFraction {
    fraction: number // fraction of offer price
  }

  widget CreateGoodButton {
    seller: Party,
    market: Market,
    good: Good
  }

  widget CreateGoodName {
    good: Good
  }

  widget CreateGoodPrice {
    good: Good
  }

  widget CreateGoodSupply {
    good: Good
  }

  widget ShowGood {
    good: Good
  }

  widget ShowMyGoodsForSale uses ShowGood {
    seller: Party,
    market: Market
  }

  widget ShowAffordableGoods uses ShowGood {
    buyer: Party,
    market: Market
  }

  widget ShowUnaffordableGoods uses ShowGood {
    buyer: Party,
    market: Market
  }

  widget ShowAllGoods uses ShowGood {
    market: Market
  }

  widget ShowTransaction {
    transaction: Transaction
  }

  widget ShowAllTransactions uses ShowTransaction {
    market: Market
  }

  widget ShowMyPurchases uses ShowTransaction {
    buyer: Party,
    market: Market
  }

  widget ShowBalance {
    party: Party
  }

  // textbox to enter a number
  widget AddAmount {
    party: Party
  }
}
